@using StoreApp.Shared

<div class="bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-bold mb-4 text-gray-900">Trạng thái đơn hàng</h2>
    
    @if (OrderStats == null || Total == 0)
    {
        <div class="h-[260px] flex items-center justify-center text-gray-500">
            Không có dữ liệu
        </div>
    }
    else
    {
        <div class="flex flex-col md:flex-row items-center gap-6">
            <div class="w-full md:w-1/2">
                <ApexChart TItem="OrderStatusData"
                           Title=""
                           Height="260"
                           Options="chartOptions">

                    <ApexPointSeries TItem="OrderStatusData"
                                     Items="ChartData"
                                     Name="Đơn hàng"
                                     SeriesType="SeriesType.Donut"
                                     XValue="@(e => e.Name)"
                                     YValue="@(e => e.Value)"
                                     ShowDataLabels />
                </ApexChart>
            </div>
            
            <div class="w-full md:w-1/2">
                <ul class="space-y-3">
                    <li class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full bg-yellow-500"></span>
                            <span class="text-gray-700">Chờ xử lý</span>
                        </div>
                        <div class="text-gray-900 font-semibold">
                            @PendingOrders <span class="text-gray-500 text-sm">(@FormatPercent(PendingOrders))</span>
                        </div>
                    </li>
                    <li class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full bg-blue-500"></span>
                            <span class="text-gray-700">Đã thanh toán</span>
                        </div>
                        <div class="text-gray-900 font-semibold">
                            @PaidOrders <span class="text-gray-500 text-sm">(@FormatPercent(PaidOrders))</span>
                        </div>
                    </li>
                    <li class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full bg-emerald-500"></span>
                            <span class="text-gray-700">Hoàn tất</span>
                        </div>
                        <div class="text-gray-900 font-semibold">
                            @CompletedOrders <span class="text-gray-500 text-sm">(@FormatPercent(CompletedOrders))</span>
                        </div>
                    </li>
                    <li class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full bg-red-500"></span>
                            <span class="text-gray-700">Đã hủy</span>
                        </div>
                        <div class="text-gray-900 font-semibold">
                            @CancelledOrders <span class="text-gray-500 text-sm">(@FormatPercent(CancelledOrders))</span>
                        </div>
                    </li>
                    <li class="flex items-center justify-between border-t pt-2 mt-1">
                        <span class="text-gray-500">Tổng đơn</span>
                        <span class="font-bold">@Total</span>
                    </li>
                </ul>
            </div>
        </div>
    }
</div>

@code {
    [Parameter]
    public OrderStatsDTO? OrderStats { get; set; }

    private int PendingOrders => OrderStats?.PendingOrders ?? 0;
    private int PaidOrders => OrderStats?.PaidOrders ?? 0;
    private int CompletedOrders => OrderStats?.CompletedOrders ?? 0;
    private int CancelledOrders => OrderStats?.CancelledOrders ?? 0;
    private int Total => PendingOrders + PaidOrders + CompletedOrders + CancelledOrders;

    private List<OrderStatusData> ChartData => new()
    {
        new OrderStatusData { Name = "Chờ xử lý", Value = PendingOrders },
        new OrderStatusData { Name = "Đã thanh toán", Value = PaidOrders },
        new OrderStatusData { Name = "Hoàn tất", Value = CompletedOrders },
        new OrderStatusData { Name = "Đã hủy", Value = CancelledOrders }
    };

    private ApexChartOptions<OrderStatusData> chartOptions = new()
    {
        Colors = new List<string> { "#eab308", "#3b82f6", "#10b981", "#ef4444" },
        Chart = new Chart { Toolbar = new Toolbar { Show = false } },
        Legend = new Legend { Show = false }
    };

    private string FormatPercent(int value)
    {
        if (Total == 0) return "0%";
        return $"{Math.Round((double)value / Total * 100)}%";
    }

    public class OrderStatusData
    {
        public string Name { get; set; } = "";
        public decimal Value { get; set; }
    }
}
