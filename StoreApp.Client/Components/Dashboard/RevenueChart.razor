@using StoreApp.Shared

<div class="bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-bold mb-4 text-gray-900">Doanh thu 7 ngày gần đây</h2>
    
    @if (Data == null || !Data.Any())
    {
        <div class="h-[300px] flex items-center justify-center text-gray-500">
            Không có dữ liệu
        </div>
    }
    else
    {
        <ApexChart TItem="RevenueDataPoint"
                   Title=""
                   Height="300"
                   Options="chartOptions">

            <ApexPointSeries TItem="RevenueDataPoint"
                             Items="Data"
                             Name="Doanh thu"
                             SeriesType="SeriesType.Line"
                             XValue="@(e => e.Label)"
                             YValue="@(e => e.Revenue)" />
            
            <ApexPointSeries TItem="RevenueDataPoint"
                             Items="Data"
                             Name="Số đơn hàng"
                             SeriesType="SeriesType.Line"
                             XValue="@(e => e.Label)"
                             YValue="@(e => (decimal)e.OrderCount)" />
        </ApexChart>
    }
</div>

@code {
    [Parameter]
    public List<RevenueDataPoint>? Data { get; set; }

    private ApexChartOptions<RevenueDataPoint> chartOptions = new()
    {
        Yaxis = new List<YAxis>
        {
            new YAxis
            {
                Title = new AxisTitle { Text = "Doanh thu" },
                Min = 0,
                Labels = new YAxisLabels
                {
                    Formatter = "function(value) { return (value / 1000000).toFixed(1) + 'M'; }"
                }
            },
            new YAxis
            {
                Opposite = true,
                Title = new AxisTitle { Text = "Số đơn hàng" },
                Min = 0,
                Labels = new YAxisLabels
                {
                    Formatter = "function(value) { return Math.round(value); }"
                }
            }
        },
        Tooltip = new Tooltip
        {
            Shared = true
        },
        Chart = new Chart
        {
            Toolbar = new Toolbar { Show = false },
            Zoom = new Zoom { Enabled = false }
        },
        Colors = new List<string> { "#3b82f6", "#10b981" },
        Stroke = new Stroke { Width = 3, Curve = Curve.Smooth }
    };
}
